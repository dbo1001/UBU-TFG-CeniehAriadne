\capitulo{5}{Aspectos relevantes del desarrollo del proyecto}

A continuación se van a mostrar los aspectos más relevantes del
desarrollo del proyecto, justificando las decisiones tomadas y dando
visibilidad a los problemas encontrados.

\section{Ciclo de vida del proyecto}

En Mayo de 2019, tuvo lugar una reunión entre las diferentes partes involucradas,
UBU y CENIEH, donde se sentaron las bases del proyecto. A esta le siguieron
muchas otras donde se fueron detallando distintos aspectos del trabajo a realizar. 
Además, dos de los miembros de la UBU participaron en un \emph{workshop} que tuvo lugar en Pisa, 
Italia, donde se adquirieron nuevos conocimientos acerca del proyecto \emph{ARIADNEplus} y se
estableció un primer contacto entre la UBU y los demás participantes del proyecto.

El 01 de febrero de 2020 se inició este trabajo con el objetivo de
llevar a cabo el proceso de integración de los datos del \emph{CENIEH} en
\emph{ARIADNEplus}. Adicionalmente, se propuso implantar en el\emph{CENIEH} una
infraestructura \emph{software} mediante la cual sus investigadores
fueran capaces de llevar a cabo las tareas de integración por sí
solos. 

El proyecto tiene una duración total de 6 meses, lo que significa
que el 01 de agosto de 2020 dará por concluido el periodo de colaboración entre
el CENIEH y la UBU. 

Las fases en las que se puede dividir el proyecto son:

\begin{itemize}
\tightlist
\item
  \textbf{Investigación}: en esta fase se realiza un estudio previo del
  proyecto \emph{ARIADNEplus}, así como de los conjuntos de datos del CENIEH
  que están involucrados en el proceso de integración.
\item
  \textbf{Desarrollo}: a lo largo de esta fase se ejecutan todas las
  tareas relacionadas con el diseño, desarrollo e implementación de la
  infraestructura \emph{software}.
\item
  \textbf{Integración}: en esta fase se integran los datos del CENIEH en
  \emph{ARIADNEplus} haciendo uso tanto de la infraestructura \emph{software}
  implementada como de los servicios ofrecidos por \emph{ARIADNEplus}.
\end{itemize}


\section{Investigación}

Durante las primeras semanas de trabajo, se llevó a cabo un estudio
exhaustivo del proyecto \emph{ARIADNEplus}, especialmente del \textbf{proceso
de integración} al que cada miembro debía someter sus datos. A medida
que se iban aprendiendo nuevos aspectos, se comprobaba su compatibilidad
con los datos propuestos por el \emph{CENIEH}, anotando en todo momento los
problemas que pudieran surgir.


\subsection{Proceso de integración}

\emph{ARIADNEplus} no agrega ni mueve datos de los sistemas de información de
los miembros del proyecto, solo añade \textbf{metadatos} a los conjuntos
de datos que son mantenidos y gestionados por cada miembro. Este tipo de 
información debe adoptar un \textbf{esquema o modelo} para poder ser
representado a través de catálogos o repositorios. En el caso de
\emph{ARIADNEplus}, cuentan ya con un esquema denominado \textbf{AO-Cat}
(\textbf{A}RIADNE \textbf{O}ntology \textbf{-} \textbf{Cat}alog),
diseñado exclusivamente para el proyecto.

Cada miembro del proyecto, incluído el \emph{CENIEH}, cuenta desde un principio
con sus propias colecciones de metadatos. Esto puede considerarse un
problema ya que, como se ha comentado anteriormente, este tipo de
información se representa a través de un esquema, el cual será distinto
en cada uno de los miembros. Ante esta situación, al no coincidir el
esquema de origen (e.g. esquema sedimentos, esquema ratón pérez, esquema litoteca...) 
con el de destino (AO-Cat), sería imposible poder representar los datos del origen en el catálogo.

\imagen{mappingProblem}{Conflicto entre esquemas de metadatos distintos.}{0.9}

Además, un esquema está formado por un conjunto de elementos, cada uno
de los cuales está sujeto a unas determinadas \textbf{reglas}. Por ejemplo,
podría especificarse el tipo de dato que almacena (\emph{string},
\emph{date}, etc.) o considerarse como imprescindible (no nulo). Este
hecho aumenta aún más la complejidad del proceso de integración ya que
cada miembro cuenta con sus propios elementos y con sus propias reglas.

Para dar solución a todos estos problemas, \emph{ARIADNEplus} propone dividir
el proceso de integración en 6 fases.

\imagen{integrationPhases}{Representación gráfica de las fases en las que se divide el proceso de integración.}{0.9}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Confirmación}: se confirman las colecciones de metadatos que
  serán agregadas y, además, se indica a qué categoria de datos de
  \emph{ARIADNEplus} pertenecen.
\item
  \textbf{Transformación}: una vez estén listos los metadatos de origen,
  se genera un fichero de definición de mapeo que permita transformar el
  esquema de metadatos de origen al esquema objetivo (\emph{AO-Cat}).
\item
  \textbf{Enriquecimiento}: se mejora la calidad de los metadatos
  sometiendo los datos a un proceso de enriquecimiento utilizando como
  fuentes externas el vocabulario \emph{Getty AAT} y \emph{PeriodO}.
\item
  \textbf{Importación}: habiendo completado las tres fases anteriores,
  se ejecuta el proceso de importación de los metadatos.
\item
  \textbf{Simulación de publicación}: con los metadatos de origen ya
  importados en la base de datos, se realiza una simulación de
  publicación.
\item
  \textbf{Publicación}: si los resultados obtenidos en la fase 5 son
  favorables, se lleva a cabo la publicación de los metadatos en el
  catálogo oficial.
\end{enumerate}

\subsubsection{Confirmación}

En esta fase se confirman qué colecciones de datos serán integradas en
el proyecto. Además, se debe indicar a qué categoría de datos de \emph{ARIADNE}
pertenecen.

\imagen{categoriesARIADNE}{Fase de confirmación.}{0.9}

Afortunadamente, los datos propuestos por el \emph{CENIEH} se obtuvieron con suma facilidad,
sin ningún tipo de reticencia por su parte. 

En la siguiente tabla se indican las principales características de cada una de las
colecciones de datos confirmadas para la integración con \emph{ARIADNEplus}.
Además, se especifica la categoría \emph{ARIADNE} a la que corresponden.

\begin{table}[H]\label{tabla:datos}
\centering
\resizebox{\textwidth}{!}{\begin{tabular}{@{}llllll@{}}
\hline
Colección          & Núm. Registros & Docs asociados & Campos                                                                                                                                                                                                                                                                                           & Formato & Categoría ARIADNE   \\ \hline
Anatomía Comparada & 571            & Sí             & \begin{tabular}[c]{@{}l@{}}SIGNA\_CENIEH, Clase, Orden,\\ Familia Género, Especie,\\ Sigla de campo, Elemento,\\ Sexo, Adulto Localidad,\\ Municipio, Provincia, Pais,\\ Tipo de objeto\end{tabular}                                                                                             & CSV     & Scientific analysis \\ \hline
Litoteca           & 99             & Sí             & \begin{tabular}[c]{@{}l@{}}Afloramiento, Sigla,\\ Localización, Datum, X, Y, Z,\\ Acceso, Tipo de Afloramiento,\\ Tipo de roca, Depositante,\\ Muestra física, Lámina\\ delgada, Laboratorio geología\\ CENIEH, Fotografías, Otros\\ datos, Topografía\end{tabular}                              & CSV     & Scientific analysis \\ \hline
Ratón Pérez        & 1323           & Sí             & \begin{tabular}[c]{@{}l@{}}Sigla, Individuo, Sexo, Edad,\\ Pieza, Superior/inferior,\\ Lado, Conservación,\\ Consolidado, Pegado,\\ Observaciones, Localización,\\ Fecha MicroCT, Archivo mCT,\\ Proyecto Amira, localización,\\ No Imágenes, kv/mA, Vxl,\\ Size, Filter, Fotos mCT\end{tabular} & CSV     & Scientific analysis \\ \hline
Sedimentos         & 7695           & No             & \begin{tabular}[c]{@{}l@{}}ReferenciaBolsa,\\ ReferenciaCaja, Yacimiento,\\ Nivel, Cuadro, Z, Situacion,\\ FechaRecogida, FechaAlmacen,\\ FechaProcesando\end{tabular}                                                                                                                           & CSV     & Scientific analysis \\ \hline
CIR                & 1853           & Sí             & Dublin Core terms                                                                                                                                                                                                                                                                              & CSV     & Scientific analysis \& Fieldwork Reports \\ \hline
\end{tabular}}\\
\caption{Colecciones de metadatos propuestas por el \emph{CENIEH} para la
integración con \emph{ARIADNEplus}.}
\end{table}

\subsubsection{Transformación}

Para evitar el problema mostrado en la Figura \ref{fig:mappingProblem},
\emph{ARIADNEplus} pone a disposición de sus miembros la \textbf{herramienta
\emph{X3ML Mapping Tool}}, disponible en el entorno virtual \emph{ARIADNEplus Mappings} del
portal \emph{ARIADNEplus Gateway} de \emph{D4Science}. Está compuesta
por un conjunto de microservicios, de código abierto, que siguen el
modelo de referencia \emph{SYNERGY} \cite{art:syn} para la transmisión y agregación de
datos.

\imagen{transformARIADNE}{Fase de transformación.}{0.9}

Los componentes clave de este servicio son:

\begin{itemize}
\tightlist
\item
  \emph{\textbf{3M -- Mapping Memory Manager}}: herramienta utilizada para la
  gestión de archivos de definición de mapeo. Proporciona una serie de
  acciones administrativas que ayudan a los proveedores de datos a
  administrar sus archivos de definición de mapeo.
\end{itemize}

\imagen{mmm3m}{Vista de la herramienta \emph{Mapping Memory Manager - 3M}.}{0.9}

\begin{itemize}
\tightlist
\item
  \emph{\textbf{3M Editor}}: provee la interfaz que permite crear asignaciones
  entre los elementos del esquema de metadatos a mapear y el esquema
  objetivo.
\end{itemize}

\imagen{3meditor}{Vista de la herramienta \emph{3M Editor}.}{0.9}

\begin{itemize}
\tightlist
\item
  \emph{\textbf{X3ML Engine}}: ejecuta la transformación de los elementos de
  origen al formato de destino. Tomando como entrada los metadatos de origen
  (en formato \emph{XML}), la descripción de las asignaciones existentes en el
  fichero de definición de mapeo y el archivo que contiene las políticas
  para la generación de \emph{URIs}, es responsable de transformar el documento
  original en un documento \emph{RDF} válido que corresponda al archivo \emph{XML} de
  entrada con las asignaciones y políticas indicadas.
\item
  \emph{\textbf{RDF visualizer}}: permite, de una forma rápida, inspeccionar los
  documentos transformados.
\end{itemize}

\imagen{rdfvisualizer}{Vista de la herramienta \emph{RDF visualizer}.}{0.6}

Esta herramienta toma un \textbf{papel decisivo} en el proceso de
integración ya que permite transformar el modelo de origen al esquema de
metadatos utilizado en \emph{ARIADNEplus} (\emph{AO-CAT}).

A continuación se van a describir los \textbf{principales \textbf{retos}} a los
que nos hemos tenido que enfrentar durante esta segunda fase:

\begin{itemize}
\tightlist
\item
  Todos los conjuntos de datos propuestos por el CENIEH están en formato
  \emph{CSV}. Esto supone un problema ya que \textbf{\emph{ARIADNEplus} solo trabaja
  con ficheros \emph{XML}}, es decir, no cuenta con ningún método de
  importación que tolere archivos \emph{CSV}.
\item
  \textbf{Los conjuntos de datos del CENIEH}, a excepción de la
  colección del \emph{CIR}, están dispuestos de forma irregular, es decir,
  \textbf{no siguen ningún esquema estandarizado}. Esto implica que para
  cada conjunto de datos, se necesita hacer un fichero de definición de
  mapeo distinto, lo que no es para nada eficiente.
\item
  En el esquema objetivo, los \textbf{elementos} pueden ser opcionales u
  \textbf{obligatorios}. Los elementos opcionales no suponen ningún
  problema ya que pueden quedar vacíos, sin embargo, los elementos
  obligatorios requieren la existencia de un elemento en el modelo de
  origen que pueda sustituirlo, es decir, que tenga el mismo
  significado. Esta regla supone un reto para el CENIEH ya que muchos de
  estos elementos obligatorios no cuentan con un elemento apto en las
  colecciones de datos propuestas.
\item
  \textbf{El contenido} almacenado en cada elemento del esquema objetivo
  \textbf{ha de tener un formato específico}. Por ejemplo, el contenido
  del elemento \emph{has\_language}, responsable de indicar el idioma en
  el que está dispuesto el objeto al que referencia, debe cumplir con el
  estándar ISO639-1 o ISO639-2. Por tanto, el elemento asignado en el
  origen debe seguir el mismo formato.
\end{itemize}


\subsubsection{Enriquecimiento}

En ocasiones, los metadatos por si solos no son lo suficientemente
precisos o claros como para describir una determinada característica del
objeto al que se refieren. En el caso de la arqueología, existen
multitud de conceptos con un alto grado de complejidad que necesitan ser
explicados en detalle. Por este motivo, \emph{ARIADNEplus} propone enriquecer
los metadatos haciendo uso del vocabulario \emph{Getty AAT} y del
cliente \emph{PeriodO}.

\imagen{enrichment}{Enriquecimiento de metadatos.}{0.9}

En la Figura \ref{fig:enrichment} se muestra el flujo de datos del proceso de
enriquecimiento de metadatos. Por una parte, vemos un archivo .json, el
cual se obtiene a través de la \textbf{herramienta \emph{Vocabulary Matching
Tool}}. Esta es otra de las herramientas que se pueden encontrar en el
entorno de investigación virtual \emph{ARIADNEplus Mappings}. Permite mapear el vocabulario utilizado
en el documento de origen al vocabulario \emph{Getty AAT}.

\imagen{vmt}{Vista de la herramienta \emph{Vocabulary Matching Tool}.}{0.9}

El archivo generado por esta herramienta (\emph{.json}) define las relaciones
entre los términos del vocabulario de origen y los términos del
vocabulario \emph{Getty AAT}. Desde el catálogo de \emph{ARIADNEplus}, todos
aquellos términos que tengan una asociación definida, serán hiperenlaces
que apunten al término \emph{Getty AAT} asociado.

\imagen{enrichedsubject}{Vista de un metadato (\emph{Subject}) antes y depués de ser enriquecido.}{0.9}

Además, en la Figura \ref{fig:enrichment} vemos representada la base de datos donde \textbf{PeriodO} almacena sus registros. Para aportar información adicional a los periodos existentes
en nuestros datos, debemos publicar en el cliente de \emph{PeriodO} nuestra
propia colección de periodos. De esta forma, \emph{ARIADNEplus} podrá recoger
desde la BD de \emph{periodO} nuestra colección para, posteriormente,
establecer una relación entre los periodos de un lado y de otro. Al
igual que con el vocabulario, todos los periodos que tengan una
asociación definida, serán hiperenlaces que apunten al objeto de
\emph{periodO}.

\imagen{enrichedating}{Vista de un metadato (\emph{Dating}) antes y depués de ser enriquecido.}{0.9}

En esta fase se encontraron varios \textbf{inconvenientes}: 

\begin{itemize}
\tightlist
\item
  Muchos de los términos existentes en los conjuntos de datos del CENIEH no están
  presentes en el vocabulario \emph{Getty AAT}. Por este motivo, solo se
  pudo enriquecer una pequeña parte del conjunto total.
\item
  Para poder publicar la colección en \emph{periodO}, se requería determinar la autoridad de
  los periodos, es decir, indicar de donde procedían. Desde el CENIEH no
  me pudieron facilitar ese dato ya que lo desconocían. Por este motivo,
  no se pudo llevar a cabo la publicación y por ende no se enriquecerieron
  los periodos.
\end{itemize}

\subsubsection{Importación}

El sistema de importación de \emph{ARIADNEplus}, conocido como \emph{ARIADNEplus}
\emph{Aggregator}, se basa en el kit de herramientas de \emph{software}
D-Net (implementado y mantenido por \emph{ISTI-CNR} \cite{isti:web}), 
que proporciona funciones integradas que permiten recopilar conjuntos 
de metadatos a través de múltiples métodos. Está disponible en el portal 
\emph{ARIADNEplus Gateway}, sin embargo, su acceso está restringido a los 
coordinadores del proyecto. 

Las principales opciones de importación son:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{\emph{OAI-PMH}} \cite{oai:web}: es un protocolo estándar para el intercambio de
  metadatos. A través de este método \emph{ARIADNEplus} puede recolectar los
  metadatos almacenados en un repositorio de forma remota.
\item
  \textbf{\emph{SFTP}} \cite{wiki:sftp} : es un protocolo de transmisión de ficheros. Esta opción
  es algo engorrosa ya que debe existir un archivo XML por recurso, es
  decir, no puedes agrupar varios registros en un mismo fichero XML. Los
  socios son responsables del servidor SFTP. Se admiten modos de
  autentificación.
\item
  \textbf{\emph{FTP(S)}} \cite{wiki:ftp}: es otro protocolo de transferencia de ficheros.
  Presenta las mismas características de importación que SFTP.
\item
  \textbf{Workspace}: se pueden subir directamente los metadatos en el
  \emph{workspace} de \emph{D4Sciente} (\emph{ARIADNEplus Gateway}). Cada socio tiene
  su propia carpeta donde puede ir almacenando los documentos \emph{XML}
  (metadatos) que desee importar.
\end{enumerate}

Dado que este sistema es inaccesible para la mayoría de los miembros
(incluido el \emph{CENIEH}), se debe escoger una de esas opciones y
comunicársela al coordinador responsable. Este nos indicará como proceder y,
una vez realizada la importación, se deben facilitar tres datos:

\begin{enumerate}
\tightlist
\item
  Qué ficheros (\emph{.xml}) de los importados se desean publicar.
\item
  Cuál es el identificador del fichero de definición de mapeo (e.g.
  \emph{Mapping/621}) almacenado en la herramienta \emph{X3ML Mapping} que 
  transformará el esquema de metadatos presente en tus ficheros al esquema \emph{AO-Cat}.
\item
  Opcionalmente, el enlace a tu colección de \emph{periodO} y/o el fichero de definición de
  mapeo (\emph{.json}) del vocabulario.
\end{enumerate}

Los conjuntos de datos del \emph{CENIEH} están almacenados de forma local,
exceptuando el \emph{CIR}. Por ello, de entre todas las opciones posibles, la
única forma válida de importar metadatos sería a través del
\emph{Workspace}.

\subsubsection{Simulación de publicación}

Una vez establecida la comunicación con el coordinador responsable del
proceso de importación, se debe esperar a su respuesta. Dependiendo del
contenido de esta, se pueden tomar dos caminos:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Nos indican que todas las partes del proceso (metadatos, mapeo,
  enriquecimiento) son correctos. En tal caso, los metadatos propuestos
  estarían ya disponibles desde el portal fantasma de \emph{ARIADNEplus}. Este
  es idéntico al original con la única diferencia de que sólo tienen
  acceso los miembros del proyecto.
\item
  Nos indican que alguna parte del proceso no es correcta. Ante esta
  situación, se debe volver hacia atrás en el proceso de integración
  para solventar los conflictos señalados por el coordinador.
\end{enumerate}

\subsubsection{Publicación}

Si en la fase previa se ha obtenido una respuesta satisfactoria, el
miembro que inició el proceso de integración sería ya capaz de observar
el resultado final sobre el catálogo fantasma. 

Una vez visualizado el resultado, deberá comunicarse de nuevo con el
responsable de la importación para indicarle sus impresiones. Se pueden
dar dos situaciones:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  El resultado es favorable. Ante esta situación el coordinador lleva a
  cabo la publicación de los datos en el portal real.
\item
  No se esperaba el resultado obtenido. En tal caso, se deben mantener
  las conversaciones hasta llegar a una solución.
\end{enumerate}

En el caso de que todo haya salido según lo planeado, el proceso de
integración para los conjuntos de datos publicados habría concluído.
Existe la posibilidad de reactivar este proceso en el caso de que se
deseen actualizar o añadir datos, sin embargo, hay que tener en cuenta
que cualquier cambio en la estructura de los datos supondría tener que
volver a realizar el proceso desde cero (primera fase).

\section{Desarrollo}

Recordemos que en la fase anterior se anotaron todos los aspectos
relevantes del proceso de integración, incluyendo además los problemas
de incompatibilidad encontrados entre dicho proceso y los datos
propuestos por el CENIEH. 

Es en esta fase cuando se aplican las competencias y los conocimientos 
adquiridos a lo largo del grado con el objetivo de desarrollar una infraestructura 
\emph{software} que sea capaz de guiar a los operarios del CENIEH en el proceso de integración
y, además, resuelva los problemas mencionados en la fase anterior.

\subsection{\emph{Omeka} como aplicación principal}

Desarrollar desde cero una infraestructura \emph{software} que cumpliera
con todos los requisitos propuestos no era viable debido a la limitación
temporal del proyecto. Por este motivo, se decidió utilizar
\emph{software} de terceros que cumpliera con un mínimo de
\textbf{requisitos}:

\begin{itemize}
\tightlist
\item
  Permitir la \textbf{gestión de metadatos}: los archivos de información
  involucrados son metadatos, por tanto, se necesita un sistema que
  permita realizar todo tipo de tareas de gestión sobre este tipo de
  datos.
\item
  Disponer de \textbf{herramientas de importación y exportación}: los
  datos de origen necesitarán ser importados a la plataforma para
  realizar sobre ellos las operaciones oportunas. Una vez gestionados,
  deberán ser exportados para someterlos al proceso de integración.
\item
  Ser \textbf{software libre}: este requisito era fundamental ya que,
  para poder adaptar la infraestructura a las necesidades del proyecto,
  se debe tener total libertad a la hora de ejecutar, copiar,
  distribuir, estudiar, modificar y mejorar el \emph{software}.
\end{itemize}

Se consideraron varios productos \emph{software} para acabar escogiendo
\href{https://omeka.org/classic/}{Omeka Classic}. Una de las
características que hacen de la aplicación una magnífica plataforma para
el proyecto es su \textbf{escalabilidad}. Gracias a su sistema de
\textbf{complementos} o \emph{plugins} cualquier programador tiene la
posibilidad de adaptarla a sus necesidades individuales sin tener que
modificar el código base de la aplicación. También cuenta con un sistema de
temas para personalizar la estética del área pública de la aplicación (\emph{frontend}).

\imagen{omekaplugins}{Complementos y temas en \emph{Omeka}.}{0.7}

Actualmente, \emph{Omeka} cuenta con una gran cantidad de \emph{plugins}
disponibles, tanto en su \href{https://omeka.org/classic/plugins/}{página
oficial} como en \href{https://daniel-km.github.io/UpgradeToOmekaS/omeka_plugins.html}{GitHub}.
Esto es posible gracias a la extensa comunidad de usuarios que le
respalda. 

Parte de estos \emph{plugins} se han podido reutilizar para
adaptar la infraestructura a las necesidades del proyecto, sin embargo,
se han tenido que desarrollar nuevos \emph{plugins} para cubrir
requisitos específicos. Además, se han llevado a cabo modificaciones
sobre alguno de los \emph{plugins} externos utilizados.

Por este motivo, la mayoría de las tareas realizadas en esta fase están directamente
relacionadas con la creación y modificación de \emph{plugins} para \emph{Omeka}.

\subsubsection{Complementos o \emph{plugins}}

Los complementos o \emph{plugins} son capaces de añadir nuevas
funcionalidades a \emph{Omeka} gracias a que esta tiene implementado un
sistema de ganchos o \emph{hooks}. Estos nos permiten acoplar código en
puntos específicos del flujo de ejecución de la aplicación, evitando así
tener que alterar el código base de esta.

Dentro de la aplicación se pueden encontrar dos tipos distintos de
\emph{hooks}: \textbf{\emph{hooks} de acción} y \textbf{filtros (\emph{filters})}.

\paragraph{\emph{Hooks} de acción.}

Este tipo de \emph{hook} permite añadir la ejecución de funciones externas en
puntos de ejecución específicos.

Por ejemplo, en el caso de que se quiera introducir un formulario en una
página de \emph{Omeka}, se debería utilizar el \emph{hook}
alojado en dicha página para ejecutar la función encargada de imprimir
el código HTML del formulario. En este ejemplo, la función no retornaría
nada ya que se limita a imprimir código, y es que en este tipo de
\emph{hooks} la función no tiene por qué devolver nada.

En los archivos de \emph{Omeka} se pueden localizar estos \emph{hooks} buscando
la función \emph{fire\_plugin\_hook()}. Una vez encontrada, desde el
\emph{plugin} que estamos desarrollando, haciendo uso de la interfaz
\emph{Omeka\_Plugin\_AbstractPlugin}, bastaría con añadir este
\emph{hook} a la lista \emph{\_hooks} e instanciar el método
correspondiente, el cual siempre tiene la nomenclatura
\emph{hook\textless NombreDelHook\textgreater()}.

\imagen{actionhooks}{Ejemplo de \emph{action hook}.}{1}

En el ejemplo vemos como \emph{fire\_plugin\_hook()} tiene dos
parámetros de entrada, el primero indica el nombre del \emph{hook} y el
segundo almacena los argumentos de entrada que tendrá la función que
almacena la acción.

\paragraph{Filtros (\emph{Filters}).}

Los filtros permiten, al igual que los \emph{hooks} de acción, ejecutar
funciones externas en puntos específicos de la aplicación. Sin embargo,
el objetivo de estos es algo distinto ya que no pretenden modificar
código sino alterar los datos de una determinada variable.

Las funciones deben tener un parámetro de entrada y otro de
salida de forma que, desde el interior de la función, se procesa el
valor de entrada y se devuelve el valor resultante.

En los archivos de \emph{Omeka} se pueden localizar estos \emph{filters}
buscando la función \emph{apply\_filters()}. Una vez encontrada, existen
dos formas de usar ese filtro:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Utilizando la interfaz \emph{Omeka\_hooksPlugin\_AbstractPlugin} es posible
  utilizar el filtro añadiendo su nombre a la lista \emph{\_filters}. A
  continuación, se añadiría el método público con el nombre
  \emph{filter} seguido del nombre del filtro.
\end{enumerate}

\imagen{filterhooksA}{Ejemplo de \emph{filter hook}.}{1}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Utilizando el método \emph{add\_filter()}, se puede utilizar el filtro
  pasando como primer parámetro el nombre del filtro implicado y como
  segundo parámetro la función que se ejecutará. En este caso, el nombre
  de la función es personalizable. Además, se puede pasar un tercer
  parámetro para indicar la prioridad de nuestro \emph{hook}, es decir,
  si existiera más de un \emph{plugin} utilizando ese mismo filtro, se
  ejecutaría la función de cada uno en función de su prioridad, de mayor
  a menor prioridad. Por defecto, todos los \emph{filtros} de cada
  \emph{plugin} tienen una prioridad de 10, por lo que el orden de
  ejecución se determina por la fecha de instalación, de más antiguos a
  más nuevos.
\end{enumerate}

\imagen{filterhooksB}{Segundo ejemplo de \emph{filter hook}.}{0.9}

\subsection{Entornos de trabajo}

Durante la fase de desarrollo, se ha trabajado sobre dos entornos visibles 
en el repositorio alojado en \emph{GitHub}:

\begin{itemize}
\tightlist
\item
  \textbf{Entorno de desarrollo}: se actualiza al cometer cambios sobre
  la rama \emph{develop}. Permite llevar un seguimiento diario del
  estado de la aplicación durante el desarrollo de la misma.
\item
  \textbf{Entorno de producción}: se actualiza al cometer cambios sobre
  la rama \emph{main}. En su interior se puede encontrar una versión
  estable de la aplicación. El intervalo de tiempo de actualización gira
  entorno a las dos semanas. 
\end{itemize}

\subsection{Despliegue de la infraestructura}

Para llevar a cabo el despliegue de la infraestructura se ha utilizado
la herramienta \emph{GitHub Actions}. Dependiendo del entorno de
trabajo, se ha procedido de una manera u otra:

\subsubsection{Servidor de desarrollo}

A través de la herramienta \emph{GitHub Actions} se ha automatizado el
despliegue de la infraestructura sobre el servidor de desarrollo. A esta
técnica se la conoce como despliegue continuo.

\imagen{cicd}{Despliegue continuo de la aplicación.}{0.9}

En la \emph{Figura} \ref{fig:cicd} vemos representado el proceso mediante el cual se lleva
a cabo el despliegue. Con el \emph{workflow} configurado y alojado en la
ruta \emph{.github/workflows} de mi repositorio en GitHub, cuando
ejecuto un \emph{push} sobre la rama \emph{develop}, si los cambios
cometidos afectan a cualquier carpeta que no sea la de \emph{/docs}, se
ejecutan las acciones correspondientes al despliegue de mi aplicación,
las cuales se pueden apreciar en la imagen.

\subsubsection{Servidor de producción}

Sobre el servidor de producción no se ha podido automatizar el
despliegue debido a que el acceso a este era privado, es decir, no se
podía establecer comunicación desde el exterior sin previa conexión al
VPN del CENIEH y el posterior acceso vía \emph{ssh} al servidor.

\imagen{dockerdeploy}{Despliegue ``semi-continuo'' de la aplicación.}{0.9}

Como solución a este inconveniente, se automatizó por separado la
compilación y publicación de la imagen \emph{Docker} asociada a nuestra
aplicación. De esta manera, cada vez que se cometía un cambio sobre la
rama \emph{main}, se ejecutaba dicho proceso, actualizando la imagen
publicada en el repositorio de \emph{DockerHub}. Finalizado el proceso,
se accedía al servidor de producción y se desplegaba manualmente la
infraestructura. Durante el despliegue, se recogían las imágenes desde
\emph{DockerHub}, incluyendo la imagen actualizada de nuestra
aplicación.
